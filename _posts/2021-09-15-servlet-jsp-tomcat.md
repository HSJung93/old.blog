---
title: "MVC 모델이란"
date: 2021-09-15T11:32:00+09:00
categories:
  - 메모
tag:
  - JSP
  - Servlet
  - Tomcat
  - WAS
header:
  teaser: /assets/images/slipBox.jpg
toc: true
toc_sticky: true
---

JSP와 서블릿으로 웹 어플리케이션 서버를 구현하는 대표적인 구조인 MVC 모델에 대한 포스팅입니다.

## WAS와 Tomcat

웹서버는 기본적으로 클라이언트가 서버에 페이지 요청을 하면 요청을 받아서 **정적** 컨텐츠를 제공한다. Web Application Server(WAS)는 DB 조회나 로직 처리 등 **동적** 컨텐츠를 제공하기 위해서 만들어진 서버이다. **WAS는 웹서버와 다양한 기능을 구현할 수 있는 컨테이너를 결합**한 것이다. 클라이언트로부터 동적인 컨텐츠에 대한 요청이 오면 웹서버가 컨테이너로 http 요청을 보낸다. **웹서버와 연동하여 실행할 수 있는 자바 환경을 제공하는 대표적인 WAS의 예시로 Tomcat**을 들 수 있다.

## 서블릿

컨테이너는 서블릿을 통하여 동적인 컨텐츠 요청을 해결하고 응답을 보낸다. **서블릿은 html 태그를 문자열 `""`로 처리하는 자바 프로그램**이다. `javax.servlet.http.HttpServlet` 클래스를 상속받아서 서블릿을 구현할 수 있다.

## 서블릿의 동작과정

1. 서블릿 컨테이너에서는 `HttpServletRequest`,`HttpServletResponse` 인스턴스를 생성한다.
2. url과 서블릿을 매핑해둔 xml 파일을 참조하여 매핑할 서블릿을 확인한다.
   1. 스프링에서는 web.xml에 서블릿을 등록(서블리 컨테이너의 생명주기에 리스터로 연결)하여 사용하지만, 스프링부트에서는 java config를 사용한다.
   2. 스프링에서는 디스패처 서블릿을 web.xml에 직접 등록했지만, 스프링부트에서는 기본으로 설정되어 있다.
3. 서블릿 인스턴스가 없다면 `init()` 메소드로 서블릿 인스턴스를 생성한다.
   1. 서블릿은 삭제되지 않고 싱글턴 패턴으로 다음번 같은 요청에 재사용된다. 즉 서블릿 컨테이너에 의하여 서블릿의 생명주기가 관리된다.
4. 서블릿 컨테이너에 스레드를 생성한다. 이 때 요청이 너무 많아 스레드가 계속 생성되면 서버에 부하가 걸리기 때문에, 요청 당 서블릿을 정해주는 로직이 효율적이어야 한다.
   1. 관리의 측면에서는 멀티스레딩을 다뤄야 한다.
   2. 개발의 측면에서는 핸들러의 공통로직이 중복되서는 안된다.
   3. 따라서 **모든 요청을 받는 전면 컨트롤러인 Dispatcher Servlet**을 둔다. 이를 프론트 컨트롤러 패턴을 따른다고 말하며 스프링 MVC도 마찬가지다.
5. 생성해둔 `HttpServletRequest`,`HttpServletResponse` 인스턴스를 인자로 해당 서블릿의 `service` 메소드를 호출한다.
6. `doGet()`이나 `doPost()` 메소드로 동적페이지를 생성한 후 `HttpServletResponse` 객체에 응답을 보낸 뒤 생성한 요청 및 응답 객체들을 삭제한다.

## 디스패처 서블릿의 동작과정

다양한 요청이 들어옴에 따라 디스패처 서블릿의 기능도 분화된다.

1. 핸들러 매핑에 요청을 보내고 요청 컨트롤러에 대한 정보를 받는다.
2. 핸들러 어댑터에 요청을 보내고, 핸들러 어댑터는 (개발자에게 남겨진 영역인)해당 핸들러의 메소드를 실행시켜 모델과 뷰를 보낸다.
3. 뷰 리졸버를 이용해서 뷰를 찾거나 생성한다. 이 뷰에 모델을 담는다.
4. 응답 결과를 생성한다.

## 디스패처 서블릿과 스프링

디스패처 서블릿은 스프링 설정을 사용하여 위임할 컴포넌트(컨트롤러, 리퀘스트 매핑, 뷰 리졸버 등)를 찾는다.
디스패처 서블릿은 스프링 컨테이너로부터 필요한 기능들을 주입받아 사용한다. 스프링 컨테이너는 빈 객체들을 관리한다. 서블릿 설정파일을 적어주면 설정대로 생성된 객체가 스프링 컨테이너에서 관리된다.

1. 서블릿 웹어플리케이션 컨텍스트: 웹 요청 처리 관련 객체들이 담겨 있다.
1. 핸들러 매핑
1. 컨트롤러
1. 뷰리졸버
1. 루트 웹어플리케이션 컨텍스트: 웹 요청 처리 이외의 객체들이 담겨 있다.
1. 서비스
1. 레포지토리

## JSP

서블릿의 문제는 사용자가 요청한 html 웹페이지를 `out.println` 메소드를 사용하여 문자열로 구현해야 한다는 점이다. 이 문제를 해결하기 위하여 자바 소스 코드 속에 html 코드가 들어간 서블릿과는 반대로, **html 소스 코드 속에 자바 소스 코드가 들어간 JSP**가 등장하였다. JSP는 자바 코드를 `<%%>` 혹은 `<%==%>`로 처리하는 html 코드이다. JSP의 장점은 컴파일과 같은 작업 없이 웹 서버의 디렉토리에 추가하는 등 서블릿과는 달리 간단한 방식으로 자바 소스 코드만을 수정할 수 있다는 점이다.

## MVC 모델

JSP의 등장으로 인하여 **비지니스 로직을 수행하는 Model, 화면을 출력하는 View, 요청과 응답의 흐름을 제어하는 Controller의 모델**이 완성되었다. MVC 모델의 웹 어플리케이션의 동작 과정은 다음과 같이 요약할 수 있다. 웹 어플리케이션은 사용자로부터 요청이 들어오면, 서블릿으로 구현된 Controller는 이 요청이 어떤 요청인지 분석하여 해당 요청을 처리할 Model로 보낸다. Model에서는 Controller부터의 요청에 대한 비지니스 로직(글쓰기, 회원 가입 등)을 수행하고 결과를 Controller에 반환한다. 그러면 Controller는 처리된 응답 결과를 화면을 출력하는 View로 보낸다. JSP로 구현된 View에서는 Controller로부터 받은 결과를 통하여 사용자에게 웹 페이지를 보여준다.

이 JSP 파일은 자바 파일인 서블릿으로 변환된 뒤, 클래스 파일인 컴파일이 되어 실행된다. 그 결과 html 파일이 생성되면 컨테이너는 이를 클라이언트에게 응답하는 것이다.
