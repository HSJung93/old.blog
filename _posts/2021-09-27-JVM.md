---
title: "JVM"
date: 2021-09-27T17:34:00+09:00
categories:
  - 메모
tag:
  - 자바
  - JVM
header:
  teaser: /assets/images/slipBox.jpg
toc: true
toc_sticky: true
---

## JVM이란

JVM은 자바 애플리케이션을 클래스 로더로 읽어 들여서 자바 API와 함께 실행하는 스택 기반의 가상 머신이다. 자바와 운영체제 사이의 중개자 역할을 수행하여, 운영체제에 구애받지 않고 자바를 재사용하도록 해준다. 가장 중요한 기능 중 하나는 메모리 관리, 가비지 콜렉팅이다.

## 실행과정

### 메모리 할당

프로그램이 실행되면 JVM은 OS로부터 프로그램이 필요로 하는 메모리를 할당받는다. 이 메모리 공간을 런타임 데이터 공간이라고 한다. Runtime Data Area는 스레드별 공간, 힙, Method Area로 구성된다.

- 스레드 별 공간

  - PC Register: 스레드가 시작될 때 생성되며, 스레드가 어떤 부분을 어떤 명령으로 실행해야할 지에 대한 기록을 한다. 수행 중인 JVM 명령의 주소를 가진다.
  - JVM 스택 영역: 프로그램 실행 시에 임시로 할당되었다가 메소드를 빠져나가면 바로 소멸되는 특성의 데이터를 저장하기 위한 영역이다. 각종 형태의 변수, 임시 데이터, 스레드나 메소드의 정보(메소드 안의 지역 변수, 매개변수, 리턴 값 등)를 저장한다. 메소드 호출 시마다 생성된다.
  - Native method 스택 영역이 존재한다. 실제 실행할 수 있는 기계어로 작성된 프로그램을 실행시키는 영역이다.

- 힙(= 객체 공간): 객체를 저장하는 가상 메모리 공간. new 연산자로 생성된 객체와 배열을 저장한다. 이미 클래스 공간에 올라온 클래스들만 객체로 생성할 수 있다.

  - 영속 세대: 생성된 객체들의 주소값이 저장된 공간으로, 스프링 프레임워크 처럼. 리플렉션을 사용하여 동적으로 클래스가 로딩되는 경우에 사용.
  - 뉴/ 영 세대: 객체들이 Eden이 최초 생성되고, Eden에서 참조되는 객체들은 서바이버 0/1에 저장된다.
  - 올드 세대: Eden에서 살아남는 객체 영역이 가득차면 minor GC가 일어나서, Eden의 값들을 Survivor 1 영역에 복사하고 나머지 영역의 객체들을 삭제한다.

- 메서드 공간(= 클래스 공간, 스태틱 공간): 클래스 정보를 메모리에 올릴 때 초기화되는 대상을 저장하기 위한 공간이다. 런타임 상수 풀이라는 상수 자료형을 저장하여 중복을 막는 공간이 내장되어 있다. 메소드, 타입, 필드 등의 정보가 올라간다.

### 컴파일 및 클래스 로드

자바 컴파일러(javac)가 자바 소스코드를 읽어 바이트코드(.class)로 변환하면, JVM이 클래스 로더로 로딩한다.

### 인터프리트

실행 엔진을 통하여 해석되고 1에서 할당된 런타임 데이터 영역에서 수행된다. 바이트코드를 기계어로 변경한다.

- 인터프리터
- 저스트인타임(JIT): 인터프리터 방식이 한줄씩 느리게 수행한다는 단점을 보완한다. 바이트 코드 전체를 컴파일하여 네이티브 코드로 변경하고 캐시에 저장해둔 후 사용한다. 인터프리팅 대신 직접 실행하여 빠르다.
