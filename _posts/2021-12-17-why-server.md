---
title: "서버"
date: 2021-12-17T10:04:00+09:00
categories:
  - 블로그
tags:
  - 서버
header:
  teaser: /assets/images/slipBox.jpg
---

## 서버의 구분과 경계가 많이 사라졌다.
- 대-모바일.
- 물리서버 성능 증가.
- 클라우드 서비스.

## 웹서버
- http를 위한 서버
- 아파치에서 nginx로 넘어가는 추세.
  - 아파치: 스레드 방식이다. 프로세스를 늘려가는 포크 과정에서 퍼포먼스 이슈.
  - nginx: 비동기 처리로 퍼포먼스가 더 좋다. 

## WAS 
- 어플리케이션 기능을 추가한 웹 서버.

## REST API
- 버전 관리의 경우 회사마다 다르다. 
  - /v1으로 URL로 표시
    - 장점: api 게이트에서 라우팅할 때 좋다. 프로토콜 분석하지 않고도 버전 별로 하드웨어 단에서 분리
    - 단점: 유지 보수
  - 내부에 표시
    - 장점: 유지 보수
    - 단점: 라우팅할 때 프로토콜을 봐야 한다. 

## Cloud
- 스케일 아웃/ 스케일 업/ 페일 오버가 너무나 중요한 요소인데 클라우드 환경에서 너무 쉽게 해결되고 있는 상황.

## Non-SQL
- 저장 형태가 다양하고 그래서 쓰이는 분야별로 용도가 있다.
- PostgreSQL의 장점
  - 객체 관계형 데이터베이스
    -  테이블 상속
    -  함수 오버로딩 
 -  동시성을 더 잘 처리한다.

## Redis
- 네이버는 메인 페이지 그 많은 쿼리를 어떻게 해결하는가?
  - 첫 페이지를 빌드한다. html 밖에 없는 페이지 같이 만든다음 nginx로 핸들링한다.
  - 꼭 필요한 부분은 redis를 cache로 사용한다.

## Message/Queue 프로토콜
- AMQP, MQTT, CoAP
- 큐는 언제 사용하는가?
  - 하프 sync, 하프 async 구조. 
  - 결재를 하는 모듈에서 어떤 트랜잭션을 거쳐서 데이터를 저장한다고 하자.
  - 결재 요청이 앞단은 비동기여야 한다. 비동기를 프로세스상으로 던진다. 
  - 그 비동기 처리가 많을 때 큐에 쌓아둔다. FIFO로 동기적으로 가져간다. 

## 구글 프로토콜 버퍼
- 구조화 데이터를 원하는 개발 언어에 맞게 직렬화

## 로깅
- 비정상 종료시 덤프 파일.
- 로그를 보는 것은 중요하다. 
- elk의 키바나
- 스마일 허브의 출근 시간대의 온라인 상태 변화. 상태 관리 : presence

## 스케일 업/ 스케일 아웃/ Failover
- 스케일 업: 서버의 성능 올리기
  - 옥션에서 db 장비를 4억짜리로 바꿈. 장비빨.
- 스케일 아웃: 서버를 늘리기
  - 요즘 표준.
  - 구글 검색용 2007년도 17만대 사용했다. 
- 페일 오버
  - 접속을 했는데 서버가 죽는 경우 어떻게 대처할 것인가?
  - 데이터를 동기화해둔 동일한 서버가 준비해두고 실패시에 다른 서버로 로테이션.
  - 동기화 = 현재 상태 유지의 기술. 
  - 레디스 센티넬

## MSA 아키텍쳐
- 검색 서비스, 주문 서비스, 결재 서비스에 대한 업무 로직들이 모노리스 아키텍쳐에서 구현하면, 스케일 업이 주된 해결방식이 된다. 동기화와 기능 별 스케일 아웃이 어렵다.
- 기능이나 기술 단위로 나눈다. 각각의 검색 UI, REST API, 업무 로직, 검색 DB로 구성된다. 
- api 게이트 웨이 vs 로드 밸런서
  - nginx를 api 게이트 웨이, ha proxy는 로드밸런서이긴한데 api 게이트 웨이처럼 사용.
- 오픈 소스 아이콘을 사용하는 것이 아니라 기능을 적어놓는 것이 좋은 아키텍쳐
  - 오픈 소스 아이콘은 자게 기능을 크게. 